import{M as x}from"./index-9aca4a97.js";import{i as m,d as y,r,c as M,g as L,o as S,a as b,h as B,u,p as C,_ as k}from"./index-89374393.js";import{u as D}from"./useFetchData-4d762871.js";import{u as H}from"./useMainScroll-baefc7ec.js";import"./formatDate-8ee1ee0b.js";async function I(s){return await m.post("/api/message",s)}async function g(s=1,n=10){return await m.get("/api/message",{params:{page:s,limit:n}})}const N=y({__name:"index",setup(s){const n=r(null);let i=r(""),c=r(10),o=r(1);const p=async()=>await g(o.value,c.value),{dataRef:e,isLoadingRef:l}=D(p,{total:0,rows:[]}),{proxy:f}=C(),_=async(a,t)=>{await I({...a})?(e.value.total++,e.value=await g(o.value,o.value*c.value),t("感谢您的留言")):t("您的操作过于频繁，请稍后再试","info")},v=a=>{if(l.value||!a)return;let t=100;Math.abs(a.scrollTop+a.clientHeight-a.scrollHeight)<=t&&h()},d=M(()=>e.value.rows.length>=e.value.total),h=async()=>{if(e.value.rows.length===0){i.value="-------博主很菜，请大佬们给点建议------";return}if(d.value){i.value="------我也是有底线的------";return}l.value=!0,o.value++;const a=await p();e.value.rows=e.value.rows.concat(a.rows),l.value=!1};return f.$eventBus.on("mainScroll",v),H(n),L(()=>{f.$eventBus.off("mainScroll",v)}),(a,t)=>(S(),b("div",{ref_key:"messageContainer",ref:n,class:"message-container"},[B(x,{title:"留言板",total:u(e).total,list:u(e).rows,onSubmit:_,isListLoading:u(l),text:i.value},null,8,["total","list","isListLoading","text"])],512))}});const P=k(N,[["__scopeId","data-v-14eaa8b3"]]);export{P as default};
